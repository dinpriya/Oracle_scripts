OCT Standalone patches total 11 patches
=============
> cat wget.sh

https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p37591516_190000_Linux-x86-64.zip 
https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p37542054_190000_Linux-x86-64.zip   
https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p37499406_190000_Linux-x86-64.zip 
https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p30972802_1927000DBRU_Linux-x86-64.zip  
https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p32132362_1927000DBRU_Linux-x86-64.zip 
https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p32177397_1927000DBRU_Linux-x86-64.zip 
https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p34774667_1927000DBRU_Linux-x86-64.zip
https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p37777295_1927000DBRU_Generic.zip 
https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p37793745_1927000DBRU_Linux-x86-64.zip 
https://artifactory.global.standardchartered.com/artifactory/vendor-generic-production-local/50702-scb-ansible-oracle/DBENG/Oracle/Build/p37896670_1927000DBRU_Linux-x86-64.zip 


Gold image for cloning method
--------------


unzip p37591516_190000_Linux-x86-64.zip 
unzip p37542054_190000_Linux-x86-64.zip   
unzip p37499406_190000_Linux-x86-64.zip 
unzip p30972802_1927000DBRU_Linux-x86-64.zip  
unzip p32132362_1927000DBRU_Linux-x86-64.zip 
unzip p32177397_1927000DBRU_Linux-x86-64.zip 
unzip p34774667_1927000DBRU_Linux-x86-64.zip
unzip p37777295_1927000DBRU_Generic.zip 
unzip p37793745_1927000DBRU_Linux-x86-64.zip 
unzip p37896670_1927000DBRU_Linux-x86-64.zip 


p6880880_190000_Linux-x86-64_Jan2025.zip


GGSCI (hklpdpsec001) 1> info all

Program     Status      Group       Lag at Chkpt  Time Since Chkpt

MANAGER     RUNNING
EXTRACT     RUNNING     EXT_SCCR    00:00:02      00:00:04
REPLICAT    RUNNING     REP_STRM    00:00:04      00:00:04
REPLICAT    RUNNING     RSTRM_ID    00:00:00      00:00:05


make sure ahf rename and dam stopped <== done


Stop gg process 

----------------- 

1. cd /u01/app/oracle/product/ogg/19c 
2. ./ggsci 
3. info all 
4. stop extract EXT_SCCR 
5. stop replicat REP_STRM 
6. Stop replicat RSTRM_ID 
7. stop MANAGER 
   info all 

export PATH=$ORACLE_HOME/bin:$PATH
export PATCH_LOC=”/u01/app/oracle/local/APRPSU2025”

>env | grep -i agent

Run as oracle
/u01/app/oracle/product/agent/agent13c/agent_inst/bin/emctl status agent

/u01/app/oracle/product/agent/agent13c/agent_inst/bin/emctl stop agent

1. Take prechecks and run prepatch from oracle/root

sudo /u01/app/grid/product/19c/crs/install/rootcrs.sh -prepatch

oracle restart

sudo /u01/app/grid/product/19c/crs/install/roothas.sh -prepatch

2. Take Oracle Home and grid home Backup

connect to grid  and take grid home backup
echo $ORACLE_HOME (Grid home)
/u01/app/grid/product/19c


cd $ORACLE_HOME
cd ..
pwd
/u01/app/grid/product

nohup tar -zcvf /u01/app/oracle/local/GRID_19c_bkp_new_03032025.tar 19c &



connect to oracle user and take oracle home backup
cd $ORACLE_HOME
cd ..
pwd
/u01/app/oracle/product/db/19.20.0.0.Jul2023

/u01/app/oracle/product/db/19.15.0.0.Apr2022
cd ..

nohup tar -zcvf /u01/app/oracle/local/OHome19.15.0.0.Apr2022.tar 19.15.0.0.Apr2022 &


3. on grid home

a.	Check the RETAIN_INACTIVE_PATCHES value in the below file. Make it 1 or 2 to retain last one or two inactive patches. 
 cat $ORACLE_HOME/OPatch/config/opatch.properties
 
b.	List the inactive patches using below command. You will get below output
$ORACLE_HOME/OPatch/opatch util listorderedinactivepatches

c.	Delete the Inactive patches using below command.
$ORACLE_HOME/OPatch/opatch util deleteinactivepatches

4. Move OPatch for both grid and db home
cd $ORACLE_HOME
mv OPatch OPatch_bkp_20112024

unzip opatch to ORACLE_HOME

## Run as grid
## Install the latest opatch into the GRID_HOME (minimum version of 12.2.0.1.45 is required)

gridhome
cd $GRID_HOME
rm -rf OPatch/*

unzip /u01/app/oracle/local/software/Apr2025RU/p6880880_190000_Linux-x86-64_Apr2025.zip -d /u01/app/grid/product/19c

grid@uklpddpoc04a:/home/grid [+ASM1]
> opatch version
OPatch Version: 12.2.0.1.46

OPatch succeeded.


5.
grid pathing from grid user:
==============
export PATH=$PATH:$ORACLE_HOME/OPatch/
export PATCH_LOC=/u01/app/oracle/local/PSUPSU2025


1) cd /u01/app/oracle/local/APRPSU2025/37591516/32895426/37642901
   $ORACLE_HOME/OPatch/opatch apply  -local
2) cd /u01/app/oracle/local/APRPSU2025/37591516/32895426/37654975
   $ORACLE_HOME/OPatch/opatch apply  -local
3) cd /u01/app/oracle/local/APRPSU2025/37591516/32895426/37643161
    $ORACLE_HOME/OPatch/opatch apply  -local
4) cd /u01/app/oracle/local/APRPSU2025/37591516/32895426/36758186
    $ORACLE_HOME/OPatch/opatch apply  -local
5) cd /u01/app/oracle/local/APRPSU2025/37591516/32895426/37762426
    $ORACLE_HOME/OPatch/opatch apply  -local
6) cd /u01/app/oracle/local/APRPSU2025/37542054
  $ORACLE_HOME/OPatch/opatch apply  -local
 
$ORACLE_HOME/OPatch/opatch lsinv

$ORACLE_HOME/OPatch/opatch lsinv |grep -i applied | sort -n

It should return

36758186
37542054
37642901
37643161
37654975
37762426


6.
oracle home pathing from oracle user:
==============
export PATH=$PATH:$ORACLE_HOME/OPatch/
export PATCH_LOC=/u01/app/oracle/local/APRPSU2025


6. on oracle home

a.	Check the RETAIN_INACTIVE_PATCHES value in the below file. Make it 1 or 2 to retain last one or two inactive patches. 
 cat $ORACLE_HOME/OPatch/config/opatch.properties
 
b.	List the inactive patches using below command. You will get below output
$ORACLE_HOME/OPatch/opatch util listorderedinactivepatches

c.	Delete the Inactive patches using below command.
$ORACLE_HOME/OPatch/opatch util deleteinactivepatches

conflict check
=============
--OCW 
$ORACLE_HOME/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir ${PATCH_LOC}/37591516/32895426/37654975
--DB PSU
$ORACLE_HOME/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir ${PATCH_LOC}/37591516/32895426/37642901

**
opatch rollback -id 32132362
opatch rollback -id 34774667
opatch rollback -id 37056207
opatch rollback -id 37125371
opatch rollback -id 37187504


/u01/app/oracle/local/software/Apr2025RU/37641958/37591516/37654975/custom/scripts/prepatch.sh -dbhome /u01/app/oracle/product/db/19c

Oracle_home Patching
======================
                  
export PATH=$PATH:$ORACLE_HOME/OPatch/
export PATCH_LOC=/u01/app/oracle/local/APRPSU2025

opatch apply ${PATCH_LOC}/37591516/32895426/37654975 -oh ${ORACLE_HOME} -local
opatch apply ${PATCH_LOC}/37591516/32895426/37642901 -oh ${ORACLE_HOME} -local


/u01/app/oracle/local/software/Apr2025RU/37591516/37641958/37654975/custom/scripts/postpatch.sh -dbhome /u01/app/oracle/product/db/


opatch apply ${PATCH_LOC}/30972802 -oh ${ORACLE_HOME} -local
opatch apply ${PATCH_LOC}/32132362 -oh ${ORACLE_HOME} -local
opatch apply ${PATCH_LOC}/32177397 -oh ${ORACLE_HOME} -local
opatch apply ${PATCH_LOC}/34774667 -oh ${ORACLE_HOME} -local
opatch apply ${PATCH_LOC}/37777295 -oh ${ORACLE_HOME} -local
opatch apply ${PATCH_LOC}/37793745 -oh ${ORACLE_HOME} -local
opatch apply ${PATCH_LOC}/37896670 -oh ${ORACLE_HOME} -local


--Jdk
$ORACLE_HOME/OPatch/opatch apply ${PATCH_LOC}/37542054  –oh ${ORACLE_HOME} -local 


/u01/app/oracle/local/APRPSU2025/37262208/37257886/37268031/custom/scripts/postpatch.sh -dbhome /u01/app/oracle/product/db/19.15.0.0.Apr2022


## Apply OJVM PSU Patch
export PATCH_LOC=/u01/app/oracle/local/APRPSU2025

cd /u01/app/oracle/product/db/19c/OPatch

opatch apply $PATCH_LOC/37499406 -oh $ORACLE_HOME -local

Troubleshoot steps:  --> Dont try unless needed
=====================

sudo /u01/app/grid/product/19c/bin/crsctl stop crs
sudo /u01/app/grid/product/19c/bin/crsctl start crs
sudo /u01/app/grid/product/19c/bin/crsctl check crs

sudo /u01/app/grid/product/19c/bin/rootcrs.sh config crs

sudo /u01/app/grid/product/19c/crs/install/rootcrs.pl -unlock
======================================================================

## Run as oracle

$ORACLE_HOME/OPatch/opatch lsinv
$ORACLE_HOME/OPatch/opatch lsinv |grep -i applied | sort -n

It should return

30972802
32132362
32177397
34774667
37499406
37542054
37642901
37654975
37777295
37793745
37896670

Opatch lspatches

oracle@uklpddpoc04a:/u01/app/oracle/product/db/19.27.0.0.Apr2025/OPatch [DUK31BLD1]
> ./opatch lspatches
32177397;EXTRACT FIX FROM BUG 30929724 FOR ORA-7445 [__INTEL_AVX_REP_MEMSET] - DREIIPOSTING
37793745;MERGE ON DATABASE RU 19.27.0.0.0 OF 37525327
37896670;MERGE ON DATABASE RU 19.27.0.0.0 OF 31061145 34739305
30972802;EXCESSIVE TRACING - KJGCR_STATCHECKCPU WRONG LOAD STATS DUE TO CURRENT SLSKSTAT BEHAVIOR IN LINUX
37777295;DATAPUMP BUNDLE PATCH 19.27.0.0.0
34774667;ORA-7445 IN PURGE QUEUE TABLE
32132362;AIM ORA-7445 [__INTEL_AVX_REP_MEMCPY] - UPDICF
37542054;JDK BUNDLE PATCH 19.0.0.0.250415
37499406;OJVM RELEASE UPDATE: 19.27.0.0.250415 (37499406)
37642901;Database Release Update : 19.27.0.0.250415 (37642901)
37654975;OCW RELEASE UPDATE 19.27.0.0.0 (37654975)



sudo /u01/app/grid/product/19c/rdbms/install/rootadd_rdbms.sh
sudo /u01/app/grid/product/19c/crs/install/rootcrs.sh -postpatch


=========================================

 7. $ORACLE_HOME/OPatch/opatch lspatches
 
 
 cd $ORACLE_HOME/rdbms/admin
$ORACLE_HOME/perl/bin/perl catcon.pl -e -l /tmp/mtest -b disable_llsts -- --x"alter trigger sys.llsts_grant disable"
$ORACLE_HOME/perl/bin/perl catcon.pl -e -l /tmp/mtest -b disable_RESTRICT_CREATE_USER -- --x"alter trigger sys.RESTRICT_CREATE_USER disable"

cd $ORACLE_HOME/rdbms/admin
$ORACLE_HOME/perl/bin/perl $ORACLE_HOME/rdbms/admin/catcon.pl -n 1 -e -b utlrp -d $ORACLE_HOME/rdbms/admin utlrp.sql


cd $ORACLE_HOME/OPatch
nohup ./datapatch -verbose > /home/oracle/datapatch_ICM074_05012025.log 2>&1 &

cd $ORACLE_HOME/rdbms/admin
$ORACLE_HOME/perl/bin/perl catcon.pl -e -l /tmp/mtest -b disable_llsts -- --x"alter trigger sys.llsts_grant enable"
$ORACLE_HOME/perl/bin/perl catcon.pl -e -l /tmp/mtest -b disable_RESTRICT_CREATE_USER -- --x"alter trigger sys.RESTRICT_CREATE_USER enable"

8. disable triggers in cdb and pdb 

alter trigger LLSTS_GRANT disable; 
alter trigger LLSTS_GRANTS disable; 
alter trigger RESTRICT_CREATE_USER disable; 



9. Run datapatch
cd $ORACLE_HOME/OPatch
nohup ./datapatch -verbose > datapatch_DOUK9BLD.log 2>&1 &

10. Enable triggers in cdb & pdb

alter trigger LLSTS_GRANT enable; 
alter trigger LLSTS_GRANTS enable; 
alter trigger RESTRICT_CREATE_USER enable; 


11. Verify patches applied or not

col DESCRIPTION for a50
col ACTION_TIME for a27
col ACTION for a10
set lines 1000
col STATUS for a10
select ACTION_TIME,PATCH_ID,ACTION,DESCRIPTION from registry$sqlpatch order by 1 desc;

 

set pages 300
set lines 180
col COMP_ID for a25
col COMP_NAME for a40
col status for a15
col VERSION for a15
SELECT con_id,COMP_ID,COMP_NAME,  VERSION, STATUS FROM SYS.CDB_REGISTRY where status<>'VALID' order by 1;

