login server - hklvdpapp071 - 10.7.148.112

export ORACLE_PDB_SID=PDBP_NGO

sqlplus / as sysdba

CREATE DIRECTORY DB_PUMP as '<path>';

select sum(bytes/1024/1024/1024) from dba_segments where segment_name in ('CDL_WKFL_LOGGER','CDL_WORKFLOW','CDL_WKFL_PYMT_AUTHMATRIX','PYMT_TRANS','CDL_AUDIT','PYMT_BATCH') and owner='S2BV4CDS_ADMIN';

SUM(BYTES/1024/1024/1024)
-------------------------
               318.757813


select directory_name,directory_path from dba_directories where directory_name='DB_PUMP';

exit

create or replace directory DB_PUMP as '/orafra/Exp_Dump';

nohup expdp userid=\'/ as sysdba\' directory=DB_PUMP dumpfile=Data_restoration_SEP_%U.dmp LOGFILE=Data_restoration_SEP.log tables=S2BV4CDS_ADMIN.CDL_WKFL_LOGGER, S2BV4CDS_ADMIN.CDL_WORKFLOW, S2BV4CDS_ADMIN.CDL_WKFL_PYMT_AUTHMATRIX, S2BV4CDS_ADMIN.PYMT_TRANS, S2BV4CDS_ADMIN.CDL_AUDIT, S2BV4CDS_ADMIN.PYMT_BATCH parallel=4 &

--Verify the logs

===================================

--DROP the Database and restore the JUNE backup 

===================================

login server - hklvdpapp071 - 10.7.148.112

export ORACLE_PDB_SID=PDBP_NGO

nohup impdp userid=\'/ as sysdba\' directory=DB_PUMP dumpfile=Data_restoration_SEP_%U.dmp logfile=Imp_Data_restoration_SEP.log transform=segment_attributes:n remap_table=S2BV4CDS_ADMIN.CDL_WKFL_LOGGER:CDL_WKFL_LOGGER_SEP, S2BV4CDS_ADMIN.CDL_WORKFLOW:CDL_WORKFLOW_SEP, S2BV4CDS_ADMIN.CDL_WKFL_PYMT_AUTHMATRIX:CDL_WKFL_PYMT_AUTHMATRIX_SEP, S2BV4CDS_ADMIN.PYMT_TRANS:PYMT_TRANS_SEP, S2BV4CDS_ADMIN.CDL_AUDIT:CDL_AUDIT_SEP, S2BV4CDS_ADMIN.PYMT_BATCH_SEP parallel=4

sqlplus / as sysdba

alter session set container=PDBP_NGO;

ALTER TABLE "S2BV4CDS_ADMIN"."CDL_WKFL_LOGGER" ADD CONSTRAINT "PK_CDL_WKFL_LOGGER_SEP" PRIMARY KEY ("BATCHREFNO", "GROUPID", "DELETEFLAG");

CREATE INDEX "S2BV4CDS_ADMIN"."PYMT_BATCH_IDX_01_SEP" ON "S2BV4CDS_ADMIN"."PYMT_BATCH_SEP" ("GROUPID", "BATCHREFNO", "DELETEFLAG");
ALTER TABLE "S2BV4CDS_ADMIN"."PYMT_BATCH_SEP" ADD CONSTRAINT "PYMT_BATCH_PK_SEP" PRIMARY KEY ("BATCHREFNO", "GROUPID", "DELETEFLAG") 
USING INDEX "S2BV4CDS_ADMIN"."PYMT_BATCH_IDX_01_SEP"  ENABLE;

ALTER TABLE "S2BV4CDS_ADMIN"."CDL_AUDIT_SEP" ADD CONSTRAINT "CDL_AUDIT_PK_SEP" PRIMARY KEY ("AUDITSRLNUM");

ALTER TABLE "S2BV4CDS_ADMIN"."PYMT_TRANS_SEP" ADD CONSTRAINT "PYMT_TRANS_PK_SEP" PRIMARY KEY ("TRANSREFNO");

ALTER TABLE "S2BV4CDS_ADMIN"."CDL_WKFL_PYMT_AUTHMATRIX_SEP" ADD CONSTRAINT "CDL_WKFL_PYMT_AUTHMATRIX_PK_SEP" PRIMARY KEY ("GROUPID", "WKFLREFNO", "REFNO1", "COMBINATIONID", "STEPID");

GRANT SELECT ON S2BV4CDS_ADMIN.CDL_WKFL_LOGGER_SEP            to SCB_USER_RO,CC_PSS_VIEW;
GRANT SELECT ON S2BV4CDS_ADMIN.CDL_WORKFLOW_SEP               to SCB_USER_RO,CC_PSS_VIEW;
GRANT SELECT ON S2BV4CDS_ADMIN.CDL_WKFL_PYMT_AUTHMATRIX_SEP   to SCB_USER_RO,CC_PSS_VIEW;
GRANT SELECT ON S2BV4CDS_ADMIN.PYMT_TRANS_SEP                 to SCB_USER_RO,CC_PSS_VIEW;
GRANT SELECT ON S2BV4CDS_ADMIN.CDL_AUDIT_SEP                  to SCB_USER_RO,CC_PSS_VIEW;
GRANT SELECT ON S2BV4CDS_ADMIN.PYMT_BATCH_SEP                 to SCB_USER_RO,CC_PSS_VIEW;

@$ORACLE_HOME/rdbms/admin/utlrp.sql

---gather stats 

exec dbms_stats.gather_schema_stats(ownname => 'S2BV4CDS_ADMIN',  cascade => TRUE, degree => 6,estimate_percent => 100,method_opt => 'FOR ALL COLUMNS SIZE AUTO'); 
